<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quản lý Khách hàng - Admin Panel | OTOTHESIU</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --gold-color: #FFD700;
      --dark-gold: #B8860B;
      --jade-black: #0D1B2A;
      --jade-dark: #041E42;
      --accent-gold: #F4E27C;
      --text-light: #E8E8E8;
      --card-bg: #1A2A3A;
      --border-radius: 10px;
      --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--jade-black);
      color: var(--text-light);
      overflow-x: hidden;
    }

    /* Navigation */
    .navbar {
      background: linear-gradient(135deg, var(--gold-color), var(--dark-gold)) !important;
      box-shadow: 0 4px 20px rgba(255, 215, 0, 0.3);
      padding: 10px 0;
    }

    .navbar-brand .brand-text {
      font-weight: bold;
      font-size: 1.5rem;
      background: linear-gradient(45deg, var(--jade-black), var(--jade-dark));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .navbar-nav .nav-link {
      color: var(--jade-black) !important;
      font-weight: 600;
      position: relative;
      transition: all 0.3s ease;
      padding: 8px 16px;
      margin: 0 5px;
      border-radius: 6px;
    }

    .navbar-nav .nav-link:hover {
      background: rgba(255, 215, 0, 0.1);
      color: var(--jade-dark) !important;
      transform: translateY(-2px);
    }

    .navbar-nav .nav-link.active {
      background: var(--jade-dark);
      color: var(--gold-color) !important;
      font-weight: 600;
    }

    .navbar-toggler {
      border: 1px solid var(--jade-black);
    }

    .navbar-toggler-icon {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%280, 0, 0, 0.8%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    }

    /* Main Content */
    .main-content {
      padding: 30px 20px;
      min-height: 100vh;
    }

    /* Page Header */
    .page-header {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 30px;
      border: 1px solid var(--gold-color);
      box-shadow: var(--box-shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .page-header h2 {
      color: var(--gold-color);
      margin: 0;
      font-weight: 600;
    }

    /* Action Buttons */
    .action-btn {
      background: linear-gradient(135deg, var(--gold-color), var(--dark-gold));
      border: none;
      color: var(--jade-black);
      padding: 12px 20px;
      font-weight: 600;
      border-radius: 50px;
      transition: all 0.3s ease;
      margin-right: 10px;
      margin-bottom: 10px;
      box-shadow: 0 4px 10px rgba(255, 215, 0, 0.3);
    }

    .action-btn:hover {
      background: linear-gradient(135deg, var(--dark-gold), var(--gold-color));
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
    }

    /* Filter Section */
    .filter-section {
      background: var(--card-bg);
      border: 1px solid var(--gold-color);
      border-radius: var(--border-radius);
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: var(--box-shadow);
    }

    .filter-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      align-items: end;
    }

    .form-group {
      margin-bottom: 0;
    }

    .form-label {
      color: var(--gold-color);
      font-weight: 600;
      margin-bottom: 8px;
    }

    .form-control, .form-select {
      background: var(--jade-dark);
      border: 1px solid var(--gold-color);
      color: var(--text-light);
      border-radius: 5px;
      padding: 10px;
    }

    .form-control:focus, .form-select:focus {
      background: var(--jade-dark);
      border-color: var(--accent-gold);
      color: var(--text-light);
      box-shadow: 0 0 0 0.2rem rgba(255, 215, 0, 0.25);
    }

    /* Table */
    .table-container {
      background: var(--card-bg);
      border: 1px solid var(--gold-color);
      border-radius: var(--border-radius);
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: var(--box-shadow);
      overflow: hidden;
    }

    .table-dark {
      --bs-table-bg: var(--jade-dark);
      --bs-table-striped-bg: rgba(255,255,255,0.05);
      --bs-table-striped-color: var(--text-light);
      --bs-table-active-bg: rgba(255,215,0,0.1);
      --bs-table-active-color: var(--text-light);
      border-color: rgba(255,215,0,0.2);
      margin: 0;
    }

    .table th {
      color: var(--gold-color);
      font-weight: 600;
      border-bottom: 2px solid var(--gold-color);
      padding: 15px;
    }

    .table td {
      color: var(--text-light);
      border-color: rgba(255,215,0,0.2);
      padding: 15px;
      vertical-align: middle;
    }

    .status-badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .status-active { background: #28a745; color: var(--text-light); }
    .status-inactive { background: #6c757d; color: var(--text-light); }
    .status-blocked { background: #dc3545; color: var(--text-light); }

    /* Action Buttons in Table */
    .btn-action {
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      font-size: 0.85rem;
      font-weight: 600;
      transition: all 0.3s ease;
      margin: 2px;
    }

    .btn-reset {
      background: linear-gradient(135deg, #17a2b8, #138496);
      color: white;
    }

    .btn-lock {
      background: linear-gradient(135deg, #ffc107, #e0a800);
      color: var(--jade-black);
    }

    .btn-unlock {
      background: linear-gradient(135deg, #28a745, #218838);
      color: white;
    }

    .btn-action:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    /* User Avatar */
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--gold-color);
    }

    /* Pagination */
    .pagination-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
    }

    .pagination {
      --bs-pagination-bg: var(--jade-dark);
      --bs-pagination-border-color: var(--gold-color);
      --bs-pagination-color: var(--text-light);
      --bs-pagination-hover-bg: var(--gold-color);
      --bs-pagination-hover-color: var(--jade-black);
      --bs-pagination-active-bg: var(--gold-color);
      --bs-pagination-active-border-color: var(--gold-color);
      --bs-pagination-active-color: var(--jade-black);
    }

    .page-info {
      color: var(--gold-color);
      font-weight: 600;
    }

    /* Buttons */
    .btn-gold {
      background: linear-gradient(135deg, var(--gold-color), var(--dark-gold));
      border: none;
      color: var(--jade-black);
      font-weight: 600;
      border-radius: 50px;
      transition: all 0.3s ease;
    }

    .btn-gold:hover {
      background: linear-gradient(135deg, var(--dark-gold), var(--gold-color));
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
    }

    /* Footer */
    footer {
      background: var(--card-bg);
      border-top: 1px solid var(--gold-color);
      margin-top: 50px;
      padding: 30px 0;
    }

    footer h5 {
      color: var(--gold-color);
      margin-bottom: 15px;
    }

    footer p {
      margin-bottom: 8px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .filter-row {
        grid-template-columns: 1fr;
      }
      
      .pagination-container {
        flex-direction: column;
        gap: 15px;
      }
      
      .table-responsive {
        font-size: 0.9rem;
      }
    }

    /* Loading animation */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in-up {
      animation: fadeInUp 0.6s ease;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--jade-dark);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--gold-color);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--dark-gold);
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg shadow-lg">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="https://preview.redd.it/petition-to-make-this-the-new-pic-of-the-sub-v0-x8o3qf29ah5f1.png?width=640&crop=smart&auto=webp&s=d04da2f01be93af3cba092e71c636a1c3bf61749" 
             alt="Logo" 
             style="height:40px; margin-right:10px; border-radius:50%; background-color:#000; padding:2px;">
        <span class="brand-text">OTOTHESIU - Admin</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="dashboard.html"><i class="fas fa-tachometer-alt me-1"></i>Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="products.html"><i class="fas fa-box me-1"></i>Sản phẩm</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="categories.html"><i class="fas fa-tags me-1"></i>Danh mục</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="stock.html"><i class="fas fa-warehouse me-1"></i>Tồn kho</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="prices.html"><i class="fas fa-tag me-1"></i>Giá cả</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="orders.html"><i class="fas fa-shopping-cart me-1"></i>Đơn hàng</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="import-products.html"><i class="fas fa-file-import me-1"></i>Nhập hàng</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="customers.html"><i class="fas fa-users me-1"></i>Khách hàng</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../index.html"><i class="fas fa-sign-out-alt me-1"></i>Đăng xuất</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Page Header -->
    <div class="page-header fade-in-up">
      <h2><i class="fas fa-users me-2"></i>Quản lý Khách hàng</h2>
      <div>
        <button class="action-btn" onclick="showBlockedUsers()" id="toggleBlockedBtn">
          <i class="fas fa-eye me-1"></i>Hiện Tài khoản Bị khóa
        </button>
      </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section fade-in-up">
      <div class="filter-row">
        <div class="form-group">
          <label class="form-label">Tìm kiếm khách hàng</label>
          <input type="text" class="form-control" id="searchCustomer" placeholder="Nhập tên, email hoặc số điện thoại...">
        </div>
        <div class="form-group">
          <label class="form-label">Trạng thái</label>
          <select class="form-select" id="statusFilter">
            <option value="">Tất cả trạng thái</option>
            <option value="active">Đang hoạt động</option>
            <option value="inactive">Không hoạt động</option>
            <option value="blocked">Bị khóa</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Sắp xếp theo</label>
          <select class="form-select" id="sortFilter">
            <option value="newest">Mới nhất</option>
            <option value="oldest">Cũ nhất</option>
            <option value="name-asc">Tên A-Z</option>
            <option value="name-desc">Tên Z-A</option>
          </select>
        </div>
        <div class="form-group">
          <button class="btn btn-gold w-100" onclick="applyFilters()">
            <i class="fas fa-filter me-1"></i>Lọc
          </button>
        </div>
      </div>
    </div>

    <!-- Customers Table -->
    <div class="table-container fade-in-up">
      <div class="table-responsive">
        <table class="table table-dark table-hover">
          <thead>
            <tr>
              <th>#</th>
              <th>Khách hàng</th>
              <th>Thông tin liên hệ</th>
              <th>Địa chỉ</th>
              <th>Ngày đăng ký</th>
              <th>Trạng thái</th>
              <th>Thao tác</th>
            </tr>
          </thead>
          <tbody id="customersTableBody">
            <!-- Customers will be loaded here -->
          </tbody>
        </table>
      </div>

      <!-- No Customers Message -->
      <div class="text-center mt-5" id="noCustomersMessage" style="display: none;">
        <i class="fas fa-users-slash fa-3x text-muted mb-3"></i>
        <h5 class="text-muted">Không có khách hàng nào</h5>
        <p class="text-muted">Không tìm thấy khách hàng phù hợp với tiêu chí tìm kiếm</p>
      </div>

      <!-- Pagination -->
      <div class="pagination-container">
        <div class="page-info" id="pageInfo">
          Hiển thị 1-10 của 0 khách hàng
        </div>
        <nav aria-label="Page navigation">
          <ul class="pagination" id="pagination">
            <!-- Pagination will be generated here -->
          </ul>
        </nav>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="py-4 mt-5">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <h5 class="mb-3">
            <i class="fas fa-phone-alt me-2"></i>Thông tin liên hệ
          </h5>
          <p class="mb-2"><i class="fas fa-envelope me-2"></i>thanhhoa13052006@gmail.com</p>
          <p class="mb-2"><i class="fas fa-phone me-2"></i>0983 XXX XXX</p>
        </div>
        <div class="col-md-6">
          <h5 class="mb-3">
            <i class="fas fa-map-marker-alt me-2"></i>Địa chỉ
          </h5>
          <p class="mb-2"><i class="fas fa-building me-2"></i>123XYZ quận 1, TP.HCM</p>
          <p class="mb-2"><i class="fas fa-user-tie me-2"></i>Liên hệ: Trần Văn Thiện</p>
        </div>
      </div>
      <hr class="my-4" style="border-color: var(--gold-color);">
      <div class="text-center">
        <p class="mb-0">&copy; 2024 OTOTHESIU. Tất cả quyền được bảo lưu.</p>
      </div>
    </div>
  </footer>

  <!-- Reset Password Modal -->
  <div class="modal fade" id="resetPasswordModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content" style="background: var(--card-bg); border: 1px solid var(--gold-color);">
        <div class="modal-header" style="border-bottom: 1px solid var(--gold-color);">
          <h5 class="modal-title" style="color: var(--gold-color);">
            <i class="fas fa-key me-2"></i>Reset Mật khẩu
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
        </div>
        <div class="modal-body">
          <p>Bạn có chắc chắn muốn reset mật khẩu cho khách hàng <strong id="resetCustomerName"></strong>?</p>
          <p class="text-muted small">Mật khẩu mới sẽ được gửi qua email: <span id="resetCustomerEmail"></span></p>
        </div>
        <div class="modal-footer" style="border-top: 1px solid var(--gold-color);">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          <button type="button" class="btn btn-gold" onclick="confirmResetPassword()">Reset Mật khẩu</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Block/Unlock Modal -->
  <div class="modal fade" id="blockUserModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content" style="background: var(--card-bg); border: 1px solid var(--gold-color);">
        <div class="modal-header" style="border-bottom: 1px solid var(--gold-color);">
          <h5 class="modal-title" style="color: var(--gold-color);">
            <i class="fas fa-lock me-2"></i><span id="blockModalTitle"></span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
        </div>
        <div class="modal-body">
          <p id="blockModalText"></p>
          <p class="text-muted small" id="blockModalNote"></p>
        </div>
        <div class="modal-footer" style="border-top: 1px solid var(--gold-color);">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          <button type="button" class="btn btn-gold" onclick="confirmBlockUser()">Xác nhận</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Biến toàn cục
    let customers = [];
    let filteredCustomers = [];
    let currentPage = 1;
    const pageSize = 10;
    let showBlockedUsersFlag = false;
    let currentActionCustomerId = null;
    let currentAction = null;

    // Tải trang
    document.addEventListener('DOMContentLoaded', function() {
      const adminUser = JSON.parse(localStorage.getItem('loggedInAdmin'));
      if (!adminUser || adminUser.role !== 'admin') {
        alert('Bạn cần đăng nhập admin để truy cập!');
        window.location.href = 'admin-login.html';
        return;
      }

      // Tải dữ liệu khách hàng
      loadCustomers();
    });

    // Tải dữ liệu khách hàng
    async function loadCustomers() {
      try {
        customers = await generateSampleCustomers(85);
        filteredCustomers = [...customers];
        renderCustomers();
        renderPagination();
      } catch (error) {
        console.error('Lỗi khi tải khách hàng:', error);
        alert('Có lỗi xảy ra khi tải danh sách khách hàng');
      }
    }

    // Tạo dữ liệu khách hàng mẫu
    async function generateSampleCustomers(count) {
      const sampleCustomers = [];
      const realNames = [
        'Phạm Thanh Hòa', 'Trần Văn Thiện', 'Nguyễn Hoàng Phúc', 
        'Phan Vỹ Ân', 'Lê Chí Nghĩa', 'Lưu Chí Bảo', 'Trương Quốc Thái', 
        'Vũ Văn Minh', 'Nguyễn Đức Tài', 'Bùi Thọ Khánh Trình'
      ];
      const districts = ['Quận 1', 'Quận 3', 'Quận 5', 'Quận 7', 'Quận 10', 'Quận Bình Thạnh', 'Quận Gò Vấp', 'Quận Phú Nhuận'];
      const actualCount = Math.min(count, realNames.length);
      
      for (let i = 0; i < actualCount; i++) {
        const fullName = realNames[i];
        const emailName = removeAccents(fullName.toLowerCase().replace(/\s+/g, ''));
        const email = `${emailName}@gmail.com`;
        const phone = `09${Math.floor(Math.random() * 90000000) + 10000000}`;
        const district = districts[Math.floor(Math.random() * districts.length)];
        const imageName = removeAccents(fullName.toLowerCase().replace(/\s+/g, '_'));
        const avatar = `anhkhachhang/${imageName}.jpg`;
        const statusRand = Math.random();
        let status = 'active';
        if (statusRand > 0.7 && statusRand <= 0.9) status = 'inactive';
        if (statusRand > 0.9) status = 'blocked';
        
        sampleCustomers.push({
          id: i + 1,
          avatar: avatar,
          name: fullName,
          email: email,
          phone: phone,
          address: `123 Đường ${i + 1}, ${district}, TP.HCM`,
          registerDate: new Date(Date.now() - Math.floor(Math.random() * 365 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0],
          status: status,
          lastLogin: Math.random() > 0.3 ? new Date(Date.now() - Math.floor(Math.random() * 30 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0] : null
        });
      }
      
      return sampleCustomers;
    }

    // Hàm bỏ dấu tiếng Việt
    function removeAccents(str) {
      return str.normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/đ/g, 'd').replace(/Đ/g, 'D');
    }

    // Hiển thị danh sách khách hàng
    function renderCustomers() {
      const tableBody = document.getElementById('customersTableBody');
      const noCustomersMessage = document.getElementById('noCustomersMessage');
      
      let customersToRender = filteredCustomers;
      if (!showBlockedUsersFlag) {
        customersToRender = filteredCustomers.filter(customer => customer.status !== 'blocked');
      }
      
      const startIndex = (currentPage - 1) * pageSize;
      const endIndex = Math.min(startIndex + pageSize, customersToRender.length);
      const currentCustomers = customersToRender.slice(startIndex, endIndex);

      if (currentCustomers.length === 0) {
        tableBody.innerHTML = '';
        noCustomersMessage.style.display = 'block';
        return;
      }

      noCustomersMessage.style.display = 'none';
      tableBody.innerHTML = '';

      currentCustomers.forEach((customer, index) => {
        const globalIndex = startIndex + index + 1;
        let statusClass = 'status-active';
        let statusText = 'Đang hoạt động';
        
        if (customer.status === 'inactive') {
          statusClass = 'status-inactive';
          statusText = 'Không hoạt động';
        } else if (customer.status === 'blocked') {
          statusClass = 'status-blocked';
          statusText = 'Bị khóa';
        }

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${globalIndex}</td>
          <td>
            <div class="d-flex align-items-center">
              <img src="${customer.avatar}" alt="${customer.name}" class="user-avatar me-3">
              <div>
                <div class="fw-bold">${customer.name}</div>
                <small class="text-muted">ID: ${customer.id}</small>
              </div>
            </div>
          </td>
          <td>
            <div><i class="fas fa-envelope me-2"></i>${customer.email}</div>
            <div><i class="fas fa-phone me-2"></i>${customer.phone}</div>
          </td>
          <td>${customer.address}</td>
          <td>
            <div>${formatDate(customer.registerDate)}</div>
            ${customer.lastLogin ? `<small class="text-muted">Đăng nhập: ${formatDate(customer.lastLogin)}</small>` : ''}
          </td>
          <td><span class="status-badge ${statusClass}">${statusText}</span></td>
          <td>
            <div class="d-flex flex-wrap gap-1">
              <button class="btn-action btn-reset" onclick="showResetPasswordModal(${customer.id})" title="Reset mật khẩu">
                <i class="fas fa-key"></i>
              </button>
              ${customer.status === 'blocked' ? 
                `<button class="btn-action btn-unlock" onclick="showBlockUserModal(${customer.id}, 'unlock')" title="Mở khóa tài khoản">
                  <i class="fas fa-unlock"></i>
                </button>` : 
                `<button class="btn-action btn-lock" onclick="showBlockUserModal(${customer.id}, 'block')" title="Khóa tài khoản">
                  <i class="fas fa-lock"></i>
                </button>`
              }
            </div>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Hiển thị phân trang
    function renderPagination() {
      const pagination = document.getElementById('pagination');
      const pageInfo = document.getElementById('pageInfo');
      
      let customersToRender = filteredCustomers;
      if (!showBlockedUsersFlag) {
        customersToRender = customersToRender.filter(customer => customer.status !== 'blocked');
      }
      
      const totalCustomers = customersToRender.length;
      const totalPages = Math.ceil(totalCustomers / pageSize);
      
      const startCustomer = (currentPage - 1) * pageSize + 1;
      const endCustomer = Math.min(currentPage * pageSize, totalCustomers);
      pageInfo.textContent = `Hiển thị ${startCustomer}-${endCustomer} của ${totalCustomers} khách hàng`;
      
      pagination.innerHTML = '';
      
      const prevLi = document.createElement('li');
      prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
      prevLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage - 1})">Trước</a>`;
      pagination.appendChild(prevLi);
      
      const maxVisiblePages = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
      let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
      
      if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
      }
      
      for (let i = startPage; i <= endPage; i++) {
        const pageLi = document.createElement('li');
        pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
        pageLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
        pagination.appendChild(pageLi);
      }
      
      const nextLi = document.createElement('li');
      nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
      nextLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Sau</a>`;
      pagination.appendChild(nextLi);
    }

    // Lọc khách hàng
    function applyFilters() {
      const searchTerm = document.getElementById('searchCustomer').value.toLowerCase();
      const status = document.getElementById('statusFilter').value;
      const sort = document.getElementById('sortFilter').value;

      filteredCustomers = customers.filter(customer => {
        const matchesSearch = 
          customer.name.toLowerCase().includes(searchTerm) ||
          customer.email.toLowerCase().includes(searchTerm) ||
          customer.phone.includes(searchTerm);
        
        const matchesStatus = !status || customer.status === status;
        
        return matchesSearch && matchesStatus;
      });

      switch (sort) {
        case 'newest':
          filteredCustomers.sort((a, b) => new Date(b.registerDate) - new Date(a.registerDate));
          break;
        case 'oldest':
          filteredCustomers.sort((a, b) => new Date(a.registerDate) - new Date(b.registerDate));
          break;
        case 'name-asc':
          filteredCustomers.sort((a, b) => a.name.localeCompare(b.name));
          break;
        case 'name-desc':
          filteredCustomers.sort((a, b) => b.name.localeCompare(a.name));
          break;
      }

      currentPage = 1;
      renderCustomers();
      renderPagination();
    }

    // Chuyển trang
    function changePage(page) {
      currentPage = page;
      renderCustomers();
      renderPagination();
    }

    // Hiển thị/ẩn tài khoản bị khóa
    function showBlockedUsers() {
      showBlockedUsersFlag = !showBlockedUsersFlag;
      const toggleBtn = document.getElementById('toggleBlockedBtn');
      
      if (showBlockedUsersFlag) {
        toggleBtn.innerHTML = '<i class="fas fa-eye-slash me-1"></i>Ẩn Tài khoản Bị khóa';
        toggleBtn.style.background = 'linear-gradient(135deg, #6c757d, #5a6268)';
      } else {
        toggleBtn.innerHTML = '<i class="fas fa-eye me-1"></i>Hiện Tài khoản Bị khóa';
        toggleBtn.style.background = 'linear-gradient(135deg, var(--gold-color), var(--dark-gold))';
      }
      
      currentPage = 1;
      renderCustomers();
      renderPagination();
    }

    // Hiển thị modal reset mật khẩu
    function showResetPasswordModal(customerId) {
      const customer = customers.find(c => c.id === customerId);
      if (customer) {
        currentActionCustomerId = customerId;
        document.getElementById('resetCustomerName').textContent = customer.name;
        document.getElementById('resetCustomerEmail').textContent = customer.email;
        new bootstrap.Modal(document.getElementById('resetPasswordModal')).show();
      }
    }

    // Xác nhận reset mật khẩu
    function confirmResetPassword() {
      if (currentActionCustomerId) {
        alert(`Đã reset mật khẩu cho khách hàng ID: ${currentActionCustomerId}\nMật khẩu mới đã được gửi qua email.`);
        
        if (typeof addAdminActivity === 'function') {
          const customer = customers.find(c => c.id === currentActionCustomerId);
          addAdminActivity(
            'Reset mật khẩu',
            `Đã reset mật khẩu cho khách hàng: ${customer.name}`,
            'info'
          );
        }
        
        bootstrap.Modal.getInstance(document.getElementById('resetPasswordModal')).hide();
        currentActionCustomerId = null;
      }
    }

    // Hiển thị modal khóa/mở khóa
    function showBlockUserModal(customerId, action) {
      const customer = customers.find(c => c.id === customerId);
      if (customer) {
        currentActionCustomerId = customerId;
        currentAction = action;
        
        const modalTitle = document.getElementById('blockModalTitle');
        const modalText = document.getElementById('blockModalText');
        const modalNote = document.getElementById('blockModalNote');
        
        if (action === 'block') {
          modalTitle.textContent = 'Khóa Tài khoản';
          modalText.textContent = `Bạn có chắc chắn muốn khóa tài khoản của khách hàng ${customer.name}?`;
          modalNote.textContent = 'Khách hàng sẽ không thể đăng nhập cho đến khi bạn mở khóa.';
        } else if (action === 'unlock') {
          modalTitle.textContent = 'Mở khóa Tài khoản';
          modalText.textContent = `Bạn có chắc chắn muốn mở khóa tài khoản của khách hàng ${customer.name}?`;
          modalNote.textContent = 'Khách hàng sẽ có thể đăng nhập lại bình thường.';
        }
        
        new bootstrap.Modal(document.getElementById('blockUserModal')).show();
      }
    }

    // Xác nhận khóa/mở khóa
    function confirmBlockUser() {
      if (currentActionCustomerId && currentAction) {
        const customer = customers.find(c => c.id === currentActionCustomerId);
        if (!customer) return;
        
        if (currentAction === 'block' && customer.status !== 'blocked') {
          customer.status = 'blocked';
          alert(`Đã khóa tài khoản của khách hàng ${customer.name}`);
          if (typeof addAdminActivity === 'function') {
            addAdminActivity(
              'Khóa tài khoản',
              `Đã khóa tài khoản khách hàng: ${customer.name}`,
              'warning'
            );
          }
        } else if (currentAction === 'unlock' && customer.status === 'blocked') {
          customer.status = 'active';
          alert(`Đã mở khóa tài khoản của khách hàng ${customer.name}`);
          if (typeof addAdminActivity === 'function') {
            addAdminActivity(
              'Mở khóa tài khoản',
              `Đã mở khóa tài khoản khách hàng: ${customer.name}`,
              'success'
            );
          }
        }
        
        bootstrap.Modal.getInstance(document.getElementById('blockUserModal')).hide();
        currentActionCustomerId = null;
        currentAction = null;
        
        renderCustomers();
        renderPagination();
      }
    }

    // Hàm hỗ trợ
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('vi-VN');
    }
  </script>
</body>
</html>